# 运动控制卡使用指南


---

## 串口指令集
- **串口波特率**：115200
- **数据格式**：所有指令均为十六进制字节  
- **包头**：0xFF  
- **包尾**：0xFE  

### 数据包结构

FF | 模式选择 | 参数1 | 参数2 | …  | FE

- **FF**：包头  
- **FE**：包尾  
- 中间字段根据模式不同而变化  

---

## 1. 电机控制模式（01）

| 字节位置 | 含义         | 可选值                          |
|---------|--------------|---------------------------------|
| 1       | 模式选择位   | 0x01                          |
| 2       | 电机编号     | 0x01 传送带<br>0x02 顶部相机 |
| 3       | 运动方式     | 0x01 定速<br>0x02 定步<br>0x03 停止 |
| 4       | 方向         | 0x01 正转<br>0x00 反转      |
| 5       | 数据高八位   | 00–FF (视运动方式而定)          |
| 6       | 数据低八位   | 00–FF (视运动方式而定)          |

#### 示例

- **定步前进 2000 步**  
  
```hex
  FF   01    01    02     01    07    D0   FE
     └─┬─┘ └─┬─┘ └─┬─┘  └─┬─┘ └─┬─┘ └─┬─┘
     模式 电机号 运动方式  方向 高八位 低八位
```

## 2. 控制四路输出模式（`02`）

### 指令格式

```hex
  FF   03    0A   FE
     └─┬─┘ └─┬─┘
      模式 输出位
```
**输出位含义**
- 将字节 0x0A 转为 4 位二进制：1010

- bit3 → bit0 对应第 1 至 4 路输出：

| 路数   | 第1路 | 第2路 | 第3路 | 第4路 |
| ---- | :-: | :-: | :-: | :-: |
| 二进制位 |  1  |  0  |  1  |  0  |
| 电平   | 高电平 | 低电平 | 高电平 | 低电平 |

## 3. 读取八路输入

### 定时返回数据

间隔时间可调,支持最短间隔时间为1ms

### 返回示例

- **返回值**：`0xAA`（十六进制）  
- **二进制**：`10101010`  
- **含义**：从 **bit7 → bit0** 对应第 1–8 路输入，`1` = 高电平，`0` = 低电平  

| 输入路数 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|----------|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| 状态     | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 |


## 张大头驱动配置指南

1. **进入菜单**：短按 `Enter`  
2. **切换选项**：短按 `Next`  
3. **退出菜单**：长按 `Next`  

### 推荐配置

| 选项    | 配置值        | 说明               |
|--------|--------------|--------------------|
| `cal`  | —            | 进行编码器自检     |
| `mode` | `CR_VFOC`    | 电流闭环矢量模式   |
| `mstep`| `1`          | 步进细分设为 1     |
| `en`   | `L`          | 低电平有效使能     |
| 其它   | 默认         | 保持出厂默认配置   |

电机速率的计算公式为:

$$
\frac{72m}{72}\times\frac{1m}{v}
\=\
\text{每秒输出脉冲数}
$$

- 其中，\(v\) 为输入脉冲频率（脉冲/秒）。  

简化后可写为：

$$
v = \text{每秒输出脉冲数}
$$

在当前配置下200个脉冲使步进电机转一圈

### 提示：

串口通信时，建议使用串口调试助手，并配置波特率与控制卡一致；

下位机代码中务必按上述包结构拼接校验字节，否则卡端会丢弃错误包。 
